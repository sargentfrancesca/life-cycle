{% extends "base.html" %}
{% import "bootstrap/wtf.html" as wtf %}

{% block title %}Life Cycle - Edit {{ ptype }}{% endblock %}

{% block page_content %}
<div class="page-header">
	{% if ptype == "Profile" %}
			{% if current_user.is_administrator() %}
				{% if user.name == current_user %}
					<h1>Edit your {{ ptype }}</h1>
				{% else %}
				<h1>Edit {{ user.name }} Profile <span class="label label-danger">Admin View</span></h1>		
				{% endif %}	
			{% else %}
			<h1>Edit your {{ ptype }}</h1>
		    {% endif %}
	{% elif ptype == "Project" %}
		{% if current_user.is_administrator() %}
		<h1>Edit {{ post.title }} Project <span class="label label-danger">Admin View</span></h1>
		{% else %}
	    <h1>Edit your {{ ptype }}</h1>
	    {% endif %}
	
	{% elif ptype == "Publication" %}
		{% if current_user.is_administrator() %}
		<h1>Edit {{ post.title }} Project <span class="label label-danger">Admin View</span></h1>
		{% else %}
	    <h1>Edit your {{ ptype }}</h1>
	    {% endif %}

	{% endif %}
</div>
<div class="col-md-12">
    {{ wtf.quick_form(form) }}
</div>
{% endblock %}


{% block scripts %}
{{ super() }}
<script>
$( document ).ready(function() {

    $('#facebook').after('<div id="authorcontrol"></div>');

    $.ajax({
        url: '{{ url_for("main.json", urlname=post.urlname) }}'
        }).done(function (data) {

        	var namesin = data.researchers["in"];
        	var namesout = data.researchers["out"];

        	$(namesin).each(function() {
        		console.log(this.name);
        		$('#authorcontrol').append('<div class= "controlin">'+this.name+'</div>')
        	});

        	$(namesout).each(function() {
        		$('#authorcontrol').append('<div class= "controlout">'+this.name+'</div>')
        	});
        }, function(){
        	$('div.controlout').bind('click', function() {        	
        		var nameval = $(this).text();
        		$.post('/add/', {
        			id : {{post.id}},
        			name : nameval
        		}).done(function() {
        			console.log("Success");

        			var selectout = $('div.controlout').filter(function () {
					    return $.trim($(this).text()) === nameval;
					});

        			$(selectout).removeClass('controlout');
        			$(selectout).addClass('controlin');

        		}).fail(function() {
        			console.log("MASSIVE FAIL");
        		})
        	});
        }, function() {
        	$('div.controlin').bind('click', function() {        	
        		var nameval = $(this).text();
        		$.post('/delete/', {
        			id : {{post.id}},
        			name : nameval
        		}).done(function() {
        			console.log("Success");

        			var selectin = $('div.controlin').filter(function () {
					    return $.trim($(this).text()) === nameval;
					});

        			$(selectin).removeClass('controlin');
        			$(selectin).addClass('controlout');

        		}).fail(function() {
        			console.log("MASSIVE FAIL");
        		})
        	});
        });

});


</script>
{{ moment.include_moment() }}
{% endblock %}
