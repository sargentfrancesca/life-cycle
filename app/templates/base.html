{% extends "bootstrap/base.html" %}

{% block title %}Flasky{% endblock %}

{% block head %}
{{ super() }}
<link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
<link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
{% endblock %}

{% block navbar %}
<div class="navbar navbar-inverse" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="{{ url_for('main.index') }}">Life Cycle</a>
        </div>
        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                {% if current_user.is_authenticated() %}
                <li><a href="{{ url_for('main.landing') }}">Landing</a></li>
                <li><a href="{{ url_for('main.user', username=current_user.username) }}">Profile</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        Post <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="{{ url_for('main.postproject') }}">Project</a></li>
                        <li><a href="{{ url_for('main.postpublication') }}">Publication</a></li>
                    </ul>
                </li>
                {% endif %}
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        Researchers <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="{{ url_for('main.researcherpage') }}">All</a></li>
                        {% for researcher in researchers %}
                        <li><a href="{{ url_for('main.user', username=researcher.username) }}">{{ researcher.name }}</a></li>
                        {% endfor %}
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        Projects <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="{{ url_for('main.projectpage') }}">All</a></li>
                        {% for project in projects %}
                        <li><a href="{{ url_for('main.projpage', id=project.id) }}">{{ project.title }}</a></li>
                        {% endfor %}
                        {% if current_user.is_authenticated() %}
                        <li role="presentation" class="divider"></li>
                        <li class="add"><a href="{{ url_for('main.postproject') }}"><span class="glyphicon glyphicon-plus"></span>  Post a Project</a></li>
                        {% endif %}
                    </ul>
                </li>

                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        Publications <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="{{ url_for('main.publicationpage') }}">All</a></li>
                        {% for publication in publications %}
                        <li><a href="{{ url_for('main.pubpage', id=publication.id) }}">{{ publication.title }}</a></li>
                        {% endfor %}
                        {% if current_user.is_authenticated() %}
                        <li role="presentation" class="divider"></li>
                        <li class="add"><a href="{{ url_for('main.postpublication') }}"><span class="glyphicon glyphicon-plus"></span>  Post a Publication</a></li>
                        {% endif %}
                    </ul>
                </li>
                
                
            </ul>
            <ul class="nav navbar-nav navbar-right">
                {% if current_user.is_authenticated() %}
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        <img src="{{ current_user.gravatar(size=18) }}">
                        Account <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="{{ url_for('auth.change_password') }}">Change Password</a></li>
                        <li><a href="{{ url_for('auth.change_email_request') }}">Change Email</a></li>
                        <li><a href="{{ url_for('auth.logout') }}">Log Out</a></li>
                    </ul>
                </li>
                {% else %}
                <li><a href="{{ url_for('auth.login') }}">Log In</a></li>
                {% endif %}
            </ul>
        </div>
    </div>
</div>
{% endblock %}

{% block content %}
<div class="container">
    {% for message in get_flashed_messages() %}
    <div class="alert alert-warning">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        {{ message }}
    </div>
    {% endfor %}

    {% block page_content %}{% endblock %}
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
$( document ).ready(function() {

    $.ajax({
        url: '{{ url_for("main.researchersjson") }}'
        }).done(function (data) {

            var names = data.json_list

                $.each(names, function(key, val){


                    $("#researchers").attr("disabled", false)
                    $("#researchers").after('<div class="authortag">' + val + '</div>')                
                });

            $('.authortag').click(function(){
                var txt = $(this).text()
                console.log(txt)
                $('#researchers').val(function(i,val) { 
                     return val + (!val ? '' : ', ') + txt;
                });
            });
        });

    $.ajax({
        url: '{{ url_for("main.projectsjson") }}'
        }).done(function (data) {
            
            var names = data.json_list
                $.each(names, function(key, val){
                    $("#project_name").attr("disabled", false)
                    $("#project_name").after('<div class="pubtag">' + val + '</div>')                
                });

            $('.pubtag').click(function(){
                var txt = $(this).text()
                console.log(txt)
                $('#project_name').val(txt);
            });
        });

    
});

</script>
{{ moment.include_moment() }}
{% endblock %}
